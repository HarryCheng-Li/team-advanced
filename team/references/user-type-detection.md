# 用户类型检测模块

## 概述

此模块用于在项目启动阶段检测用户类型（技术用户 vs 非技术用户），并根据用户类型调整后续的访谈策略。

---

## 1. 用户类型检测函数

```javascript
/**
 * 检测用户类型
 * @param {string} userInput - 用户的初始需求描述
 * @returns {Object} 检测结果
 */
function detectUserType(userInput) {
  // 技术关键词列表
  const techKeywords = [
    // API 与架构
    'API', 'REST', 'GraphQL', '微服务', '网关', '中间件',

    // 数据库
    '数据库', 'SQL', 'NoSQL', 'Redis', 'MongoDB', 'MySQL', 'PostgreSQL',

    // 容器与部署
    'Docker', 'K8s', 'Kubernetes', 'CI/CD', 'DevOps',

    // 编程语言
    'TypeScript', 'JavaScript', 'Python', 'Java', 'Go', 'Rust', 'PHP',

    // 前端框架
    '框架', 'React', 'Vue', 'Angular', 'Next.js', 'Nuxt', 'Svelte',

    // 消息队列
    'MQ', '消息队列', 'Kafka', 'RabbitMQ',

    // 基础设施
    '缓存', '负载均衡', 'CDN', 'AWS', '云服务',

    // 其他技术术语
    'JWT', 'OAuth', 'SSR', 'SSG', 'SEO', 'WebSocket', 'gRPC'
  ];

  const techCount = techKeywords.filter(k =>
    userInput.toLowerCase().includes(k.toLowerCase())
  ).length;

  // 匹配到的关键词
  const matchedKeywords = techKeywords.filter(k =>
    userInput.toLowerCase().includes(k.toLowerCase())
  );

  // 计算置信度
  const confidence = Math.min(techCount / 3, 1); // 3个以上关键词达到100%置信度

  return {
    type: techCount >= 3 ? 'technical' : 'non-technical',
    confidence: confidence,
    matchedKeywords: matchedKeywords,
    techScore: techCount
  };
}
```

### 使用示例

```javascript
// 技术用户示例
const techUserInput = `
  我们需要用 React 和 Node.js 构建一个微服务架构的电商平台，
  使用 PostgreSQL 作为主数据库，Redis 做缓存，Kafka 处理消息队列。
`;
const techResult = detectUserType(techUserInput);
// {
//   type: 'technical',
//   confidence: 1,
//   matchedKeywords: ['React', '微服务', 'PostgreSQL', 'Redis', '缓存', 'Kafka', '消息队列'],
//   techScore: 7
// }

// 非技术用户示例
const nonTechUserInput = `
  我想做一个卖衣服的网站，用户可以浏览商品、加入购物车、在线支付。
`;
const nonTechResult = detectUserType(nonTechUserInput);
// {
//   type: 'non-technical',
//   confidence: 0,
//   matchedKeywords: [],
//   techScore: 0
// }
```

---

## 2. 盲点问题库（仅非技术用户）

当检测到用户为非技术用户时，需要通过以下盲点问题补充需求信息。

### 2.1 使用场景盲点（3题）

| 编号 | 问题 | 目的 |
|------|------|------|
| U1 | **谁来使用这个系统？**（目标用户画像：年龄、职业、技术熟练度） | 了解终端用户特征，影响UI/UX设计 |
| U2 | **用户在什么场景下使用？**（桌面/移动端/两者都要？办公室/户外/碎片时间？） | 确定平台优先级和响应式需求 |
| U3 | **用户完成一个典型任务的流程是什么？**（从开始到结束的完整路径） | 梳理核心用户旅程，发现隐藏需求 |

### 2.2 成本与时间盲点（3题）

| 编号 | 问题 | 目的 |
|------|------|------|
| C1 | **项目的预算范围是多少？**（如果有具体数字更好，或者给一个范围） | 评估功能范围和实现方案 |
| C2 | **预期的上线时间是什么时候？**（有没有硬性截止日期？如展会、营销活动） | 确定MVP范围和迭代计划 |
| C3 | **是否有现有系统需要整合？**（数据迁移、遗留系统对接） | 评估额外工作量和风险 |

### 2.3 运营与安全盲点（3题）

| 编号 | 问题 | 目的 |
|------|------|------|
| O1 | **上线后谁来维护和更新？**（内部团队/外包/还没考虑） | 决定技术栈复杂度和文档需求 |
| O2 | **需要处理用户数据吗？**（个人信息的收集、存储、合规要求） | 评估安全和合规需求（GDPR等） |
| O3 | **预期用户量级是多少？**（日活、峰值） | 影响架构设计和基础设施规划 |

### 2.4 成功标准盲点（2题）

| 编号 | 问题 | 目的 |
|------|------|------|
| S1 | **如何定义项目成功？**（用户量、交易额、效率提升、品牌形象？） | 明确核心目标，指导优先级决策 |
| S2 | **是否有竞品参考？**（喜欢/不喜欢竞品的哪些方面？） | 了解期望和差异化需求 |

---

## 3. Interview 策略

### 3.1 技术用户策略

**特征：** 用户描述中包含3个以上技术关键词

**策略：**
1. 直接进入技术讨论
2. 可以使用技术术语
3. 重点讨论架构选型和技术约束
4. 快速确认技术细节

**对话示例：**
```
AI: 看到你提到要用 React 和微服务架构，是否已经有现成的基础设施？
    还是说这也需要从零搭建？

User: 目前只有基础的云服务器，K8s 集群还没搭。

AI: 了解，那我们需要把容器化部署方案也纳入规划。
    关于数据库，你们倾向于用托管服务还是自建？
```

### 3.2 非技术用户策略

**特征：** 用户描述中技术关键词少于3个

**策略：**
1. 先用通俗语言解释项目方向
2. 按顺序询问盲点问题（优先使用场景，再成本时间，然后运营安全，最后成功标准）
3. 根据回答逐步细化需求
4. 避免使用复杂技术术语

**对话示例：**
```
AI: 这个卖衣服的网站听起来很有意思！为了更好地帮你规划，
    我想先了解几个关键问题：

    首先，你的目标客户是谁呢？主要是年轻人还是全年龄段？

User: 主要是25-40岁的都市白领女性。

AI: 好的，这个群体通常习惯用手机购物。
    所以网站需要同时支持手机和电脑访问，对吗？

User: 对的，手机端更重要一些。

AI: 明白了。那预算方面，你大概期望投入多少？
    这样我可以帮你规划一个合适的方案范围。
```

---

## 4. 集成示例

### 4.1 在 Phase 2 中集成

```markdown
## Phase 2: 需求收集与澄清

### 2.1 用户类型检测
在首次接收用户需求后，立即调用 `detectUserType()` 函数：

1. 如果 `type === 'technical'`：
   - 跳过盲点问题环节
   - 直接进入技术方案讨论
   - 使用 `memory.md` 记录技术决策

2. 如果 `type === 'non-technical'`：
   - 启动盲点问题流程
   - 按 U -> C -> O -> S 顺序提问
   - 每个类别至少问1-2题
   - 记录到 `requirements.md`

### 2.2 需求收集模板

#### 技术用户模板
```markdown
## 技术需求

### 技术栈
- 前端：[用户指定]
- 后端：[用户指定]
- 数据库：[用户指定]
- 基础设施：[用户指定]

### 架构要求
- [用户提供的架构约束]

### 集成需求
- [现有系统对接需求]
```

#### 非技术用户模板
```markdown
## 业务需求

### 目标用户
- 用户画像：[来自 U1]
- 使用场景：[来自 U2]
- 核心流程：[来自 U3]

### 约束条件
- 预算：[来自 C1]
- 时间：[来自 C2]
- 现有系统：[来自 C3]

### 运营考量
- 维护方案：[来自 O1]
- 数据合规：[来自 O2]
- 用户量级：[来自 O3]

### 成功指标
- 核心目标：[来自 S1]
- 竞品参考：[来自 S2]
```
```

### 4.2 完整工作流程

```
用户输入需求
     │
     ▼
┌─────────────────┐
│ detectUserType  │
└────────┬────────┘
         │
    ┌────┴────┐
    ▼         ▼
技术用户   非技术用户
    │         │
    ▼         ▼
技术讨论   盲点问题
    │         │
    ▼         ▼
技术方案   业务方案
    │         │
    └────┬────┘
         │
         ▼
    Phase 3: 规划
```

---

## 5. 注意事项

1. **边界情况处理**
   - 技术关键词恰好为2-3个时，置信度较低，建议混合策略
   - 用户可能部分懂技术，根据实际情况灵活调整

2. **关键词更新**
   - 定期更新技术关键词列表
   - 根据新兴技术添加新关键词

3. **多语言支持**
   - 当前关键词列表支持中英文混合
   - 可扩展支持更多语言

4. **隐私考虑**
   - 用户输入不做持久化存储
   - 仅用于当前会话的类型判断
